<?xml version="1.0" encoding="utf-8"?>
<modification>
  <name>Modification Default</name>
  <code>default</code>
  <version>1.0</version>
  <author>OpenCart Ltd</author>
  <link>http://www.opencart.com</link>
  <file path="system/{engine,library}/{action,loader,config,language}*.php">
	<operation>
      <search regex="true">
        <![CDATA[~(require|include)(_once)?\(([^)]+)~]]>
      </search>
      <add position="replace">
        <![CDATA[$1$2(modification($3)]]>
      </add>
    </operation>
  </file>
  <file path="system/engine/loader.php">
    <operation>
      <search trim="true"><![CDATA[$model = str_replace('../', '', (string)$model);]]></search>
      <add position="after"><![CDATA[
        $mod_file = DIR_MODIFICATION . ((defined('HTTP_CATALOG')) ? 'admin' : 'catalog') . '/model/' . $model . '.php';]]></add>
    </operation>
    <operation>
      <search trim="true"><![CDATA[$this->registry->set('model_' . str_replace('/', '_', $model), new $class($this->registry));]]></search>
      <add position="after"><![CDATA[
        } elseif (file_exists($mod_file)) {
            include_once($mod_file);

            $this->registry->set('model_' . str_replace('/', '_', $model), new $class($this->registry));]]></add>
    </operation>
  </file>
</modification>
