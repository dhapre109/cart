{% if (error is defined) %}
    <div class="alert alert-danger">
        <i class="fa fa-exclamation-circle">
            &nbsp;{{ error }}
        </i> 
        <button type="button" class="close" data-dismiss="alert">×</button>
    </div>
{% else %} 
    <div id="card-element"></div>

    <div class="buttons">
        <div class="pull-right">
            <form action="{{ action }}" method="post" id="mfFormCheckout">
                <input type="submit" value="{{ button_confirm }}" class="btn btn-primary" id="mfButtonCheckout" data-loading-text="Loading..." />
            </form>
        </div>
    </div>

    <script type="text/javascript">
        $(document).ready(function () {

            var mfConfig = {
                countryCode: "{{ session.CountryCode }}",
                sessionId: "{{ session.SessionId }}",
                cardViewId: "card-element",
                // The following style is optional.
                style: {
                    cardHeight: 130,
                    input: {
                        color: "black",
                        fontSize: "13px",
                        fontFamily: "sans-serif",
                        inputHeight: "32px",
                        inputMargin: "0px",
                        borderColor: "c7c7c7",
                        borderWidth: "1px",
                        borderRadius: "8px",
                        boxShadow: "",
                        placeHolder: {
                            holderName: "Name On Card",
                            cardNumber: "Number",
                            expiryDate: "MM /YY",
                            securityCode: "CVV"
                        }
                    },
                    label: {
                        display: false,
                        color: "black",
                        fontSize: "13px",
                        fontFamily: "sans-serif",
                        text: {
                            holderName: "Card Holder Name",
                            cardNumber: "Card Number",
                            expiryDate: "ExpiryDate",
                            securityCode: "Security Code"
                        }
                    },
                    error: {
                        borderColor: "red",
                        borderRadius: "8px",
                        boxShadow: "0px"
                    }
                }
            };

            myFatoorah.init(mfConfig);
            window.addEventListener("message", myFatoorah.recievedMessage, false);

            var fc = '#mfFormCheckout';
            var pl = '#mfButtonCheckout';

            $(fc).on('click', pl, function (e) {
                $('#mfErrorDiv').remove();
                e.preventDefault(); // Disable "Place Order" button

                $(pl).button('loading');
                
                myFatoorah.submit()
                        .then(function (response) {// On success
                            $(fc).append('<input type="hidden" id="mfData" name="mfData" value="' + response.SessionId + '">');
                            $(fc).off(); // Enable back "Place Order button
                            $(fc).submit(); // Trigger submit

                        }, function (error) { // In case of errors
                            $(pl).button('reset');
                            $('#card-element').before('<div id="mfErrorDiv" class="alert alert-danger"><i class="fa fa-exclamation-circle"> ' + error + '</i><button type="button" class="close" data-dismiss="alert">×</button></div>');
                        });
            });
        });

    </script>
{% endif %}
